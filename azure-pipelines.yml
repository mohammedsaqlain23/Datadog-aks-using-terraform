trigger:
  - main

pool:
  name: self-hosted-linux

variables:
  - group: datadog-aks-vars

steps:
  - checkout: self

  # Azure Login using Service Connection
  - task: AzureCLI@2
    displayName: Azure Login
    inputs:
      azureSubscription: azure-connection
      scriptType: bash
      scriptLocation: inlineScript
      inlineScript: |
        az account show

  # Terraform Init
  - bash: terraform init
    displayName: Terraform Init

<<<<<<< HEAD
  # Terraform Plan
  - bash: terraform plan
=======
  # Terraform Plan (non-interactive)
  - bash: terraform plan -input=false
>>>>>>> 7ff5fb0 (Fix Terraform vars and optimize pipeline)
    displayName: Terraform Plan
    env:
      TF_VAR_aks_cluster_name: $(AKS_CLUSTER_NAME)
      TF_VAR_resource_group: $(AKS_RESOURCE_GROUP)
      TF_VAR_datadog_api_key: $(DATADOG_API_KEY)

<<<<<<< HEAD
  # Terraform Apply
  - bash: terraform apply -auto-approve
=======
  # Terraform Apply (non-interactive)
  - bash: terraform apply -input=false -auto-approve
>>>>>>> 7ff5fb0 (Fix Terraform vars and optimize pipeline)
    displayName: Terraform Apply
    env:
      TF_VAR_aks_cluster_name: $(AKS_CLUSTER_NAME)
      TF_VAR_resource_group: $(AKS_RESOURCE_GROUP)
      TF_VAR_datadog_api_key: $(DATADOG_API_KEY)
